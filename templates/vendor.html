{% load static %}

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<title>Cotton Sandhai - Vendor Details</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap.css">
    <!--link rel="stylesheet" href="vendor/responsive/css/responsive.bootstrap.min.css" type="text/css" /-->
    <link rel="stylesheet" href= "{% static 'vendor/datatable/css/jquery.dataTables.min.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/buttons/css/buttons.bootstrap.min.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'vendor/buttons/css/buttons.bootstrap.min.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'vendor/bootstrap-3.4.1-dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
     <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap.css">
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>


  <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.js"></script>
  <script src="../static/js/jquery-3.3.1.min.js"></script>
  <script src="../static/vendor/bootstrap-3.4.1-dist/js/bootstrap.min.js"></script>
  <script src="../static/js/jquery-3.3.1.min.js"></script>
  <script src="../static/vendor/datatable/js/jquery.dataTables.min.js"></script>
  <script src="../static/vendor/datatable/js/dataTables.bootstrap.min.js"></script>
  <!--script src="vendor/responsive/js/responsive.bootstrap.min.js"></!--script-->
  <script src="../static/vendor/buttons/js/dataTables.buttons.min.js"></script>
  <script src="../static/vendor/buttons/js/buttons.bootstrap.min.js"></script>
  <script src="../static/vendor/buttons/js/buttons.html5.min.js"></script>
  <script src="../static/vendor/bootbox/bootbox.js"></script>
  <script src="../static/vendor/bootbox/bootbox.min.js"></script>



     <link rel="stylesheet" href="../static/vendor/jquery-ui-1.12.1/jquery-ui.css">
    <link rel="stylesheet" href="../static/vendor/jquery-ui-1.12.1/jquery-ui.min.js">

    <script src="../static/vendor/jquery-ui-1.12.1/jquery-ui.js"></script>
    <script src="../static/vendor/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="../static/vendor/bootstrap-3.4.1-dist/js/bootstrap.min.js"></script>
 <script src="../static/js/jquery.steps.js"></script>
<script src="../static/js/main.js"></script>
<style>      
  .tabcontainer{

  box-shadow: 0px 0px 10px rgba(0,0,0,.4);
  background-color:rgb(243, 243, 243) ;
  padding-bottom:20px;
  padding-top:20px;  
  margin-left:280px;
  margin-top:60px;
  margin-right:20px;
  max-width:79%;
}
.confirmdel{
  font-weight:bold;
  color:red;
}
#example.dt-buttons {
 float: right !important;
}
#example.btn{float: right !important;}

.btnview{
    display: none;
  }
  .viewvend{
    text-decoration:none;
    color:white;
  }
  .tbody .tr{
    border-bottom: 1px solid rgb(228, 228, 228);
  }

tbody{
  border-bottom:1px solid rgb(255, 255, 255);
}
  @media (max-width:767px) {


	/* Force table to not be like tables anymore */
	table, thead, tbody, th, td, tr {
		display: block;
    background-color:rgb(243, 243, 243) !important;
  }


  .table{
    height:100vw;
    max-width:100%;
    margin-left:0px !important;
    border-bottom: 0px solid rgb(255, 255, 255);
    }

  .tabcontainer{
    max-width:91%;
    max-height:130%!important;
    margin-left:0px;
  }

  .icn{
    margin-left:15px !important;
  }
  .table{
    border-bottom:1px solid rgb(163, 15, 15) !important;
  }

  .datatable  .dataTables_info{
   visibility: hidden;
   display: none;

  }  .dataTables_filter input[type="search"]
    {width:60vw;
    margin-left:10px !important;
  }
  .btnview{
    display:inline-block ;
  }
	/* Hide table headers (but not display: none;, for accessibility) */
	thead tr {

    position: absolute !important ;
    margin-top:15px;
		left: -9999px;
	}

  tr { border: 1px solid #ccc; }

  tbody tr{
    margin-bottom: 20px;
    border-bottom: 1px solid rgb(173, 129, 129);
  }
	td {
		/* Behave  like a "row" */
		border: none;
		border-bottom: 0px solid rgb(255, 255, 255);
		position: relative;
		padding-left: 50%;
	}

	td.details-control {
  display: none;
  }
  .dataTables_wrapper .dataTables_filter input[type="search"]
    {
    width:63vw !important;
  float: center !important;
  margin-left:5% !important;
    }

	td:before {
		/* Now like a table header */
    font-weight:600;
		top: 6px;
		left: 20px;
		width: 45%;
		padding-right: 10px;
		white-space: nowrap;
	}
		/*
		Label the data
    You could also use a data-* attribute and content for this. That way "bloats" the HTML, this way means you need to keep HTML and CSS in sync. Lea Verou has a clever way to handle with text-shadow.
		*/
		td:nth-of-type(2):before { content: "Name"; }
		td:nth-of-type(3):before { content: "Type"; }
		td:nth-of-type(4):before { content: "State"; }
		td:nth-of-type(5):before { content: "Insurance Ex.Date"; }

  .dataTables_wrapper .dataTables_info
  {
    margin-top: 5px;

  }
  }

  .sidepanel  {
  height:100%;
  }


</style>
</head>

<body style="background-color:white">
<!--Top menu-->

<div id="wrapper" class="wrapper">
	<!---Top menu-->
	<div class="top_navbar">
	  <div class="openbtn" onclick="openNav()">
		 <div class="one"></div>
		 <div class="two"></div>
		 <div class="three"></div>
	  </div>
	  <div class="top_menu">
		<div class="logo"><img src="../static/images/logo3.jpg"/><br></div>

		<!---------Top nav Icons-->
		<ul>
			<div class="dropdown">
			  <li class="dropbtn">
				<a href="#"  class="nav-link dropdown-toggle" href="#" id="navbarDropdown1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
				<span class="glyphicon glyphicon-user"></span>
				</a>
				<div class="dropdown-menu dropdown-content dropdown-menu-right" role="menu" aria-labelledby="navbarDropdown1">
				  <a href="accountinfo">Account Info</a>
				  <a href="#">Payment Info</a>
				  <a href="#">Forgot Password</a>
			   </div>
			  </li>
			  </div>

		  <!-----Account Icon-->

		  <div class="dropdown">
			<li class="dropbtn">
				<a href="#"  class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
				  <span class="glyphicon glyphicon-bell alertNotificacao"></span>
				  <span id="notificationsBadge" class='badgeAlert'>3</span>
				</a>

				<div class="dropdown-menu notification dropdown-menu-right" role="menu" aria-labelledby="navbarDropdown">
				  <div class="topc" >
					<h5 class="noticard-title">Notifications</h5>
				  </div>

					<div class="card noticard">
					  <div class="card-body">
						<h5 class="card-title  noticard-title">Special title treatment</h5>
						<p class="card-text noticart-text">With supporting text below as a natural lead-in to additional.</p>

					  </div>
					  <div class="notisection-title-divider"></div>
					</div>

					<div class="card noticard" >
					  <div class="card-body">
						<h5 class="card-title noticard-title">Special title treatment</h5>
						<p class="card-text  noticart-text">With supporting text below as a natural lead-in to additional content.</p>

					  </div>
					  <div class="notisection-title-divider"></div>
					</div>

					<div class="card noticard" >
					  <div class="card-body">
						<h5 class="card-title noticard-title">Special title treatment</h5>
						<p class="card-text  noticart-text">With supporting text below as a natural lead-in to additional content.</p>

					  </div>
					</div>
					</div>

				</li>
			</div>



		  <!-----Logout Icon-->
			  <div class="dropdown">
			<li class="dropbtn">
			  <a href="#" class="nav-link dropdown-toggle" id="navbarDropown1" role="button"  ><!-- data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"-->
			  <span class="glyphicon glyphicon-arrow-right"></span>
			  </a>
			 </li>
			</div>

			  </ul>
			</div>
		  </div>
  <!-- Sidebar -->

  <div id="mySidepanel" class="sidepanel">  
     <ul class="sidebar-nav" id="">     
       <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Ã—</a>
     
        <li><a href="traders" >Trades</a></li>
        <li><a href="vendors">Vendors</a></li>
     </ul>
  </div>

  <!-- Add Button -->
  <br>
  <div id="test">
  </div>

  <!-- Main container -->
  <div class="container tabcontainer"> 
    <table role="table" id="example" style="font-family: 'Poppins', sans-serif;background-color:rgb(255, 255, 255); ">
    <thead role="rowgroup">
    <tr data-id="1" role="row">
          <th></th>
          <th data-orderable="true" role="columnheader">CS Vendor Id</th>
          <th  data-orderable="true" role="columnheader">Company Nick Name</th>
          <th data-orderable="true" role="columnheader">Primary Email</th>
          <th data-orderable="true" role="columnheader">State</th>

          <th  role="columnheader"></th>
          <th  role="columnheader"></th>
    </tr>
    </thead>


         <tbody class="tbody" role="rowgroup">
         {% for vendors_info in vendors_infos %}
          <tr id="user-{{vendors_info.vendor_id}}" class="tr" role="row">
          <td  role="cell" class="details-control"></td>
          <td role="cell">{{vendors_info.vendor_id}}</td>
          <td role="cell" class="tdid">{{vendors_info.company_nick_name}}</td>
          <td role="cell">{{vendors_info.primary_email}}</td>
          <td role="cell">{{vendors_info.state}}</td>

         <form action="editVendorDetails" method="POST" class="form-register">
          {% csrf_token %}
                <td role="cell"><p data-placement="top" data-toggle="tooltip" title="Edit"><button type="submit" class="btn btn-prim btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit" value={{vendors_info.vendor_id}} name="Edit"><span class="glyphicon glyphicon-pencil"></span></button></p></td>
          </form>
            <td role="cell">
                    <p data-placement="top" data-toggle="tooltip" title="Delete">

                            <button type="button" name="cancel_delete" onClick="deleteUser('{{vendors_info.vendor_id}}', '{{vendors_info.company_nick_name}}')" data-title="Delete"
                                class="btnDelete btn btn-dan btn-xs" >
                            <span class="glyphicon glyphicon-trash"></span>
                            </button>

                    </p>
            </td>
         <!--</form>-->
        </tr>
        {% endfor %}
      </tbody>


    </table>
  </div>
  
  </div>


<!---- Modal HTML --->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header">
                <!--div class="icon-box">
                <i class="material-icons">&#xE5CD;</i>
                </!--div-->
                <h4 class="modal-title">Are you sure?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">

                    <p>Do you really want to delete these records? This process cannot be undone.</p>
            </div>
            <div class="modal-footer">
                 <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                <form name="deleteModalForm" id="deleteModalForm" action="deleteVendorDetails" method="POST" class="form-delete">
                    {% csrf_token %}

                    <button type="submit" class="btn btn-danger" id="btnDelteYes" data-dismiss="modal" data-backdrop="false">Delete</button>
                    <input type="text" name="hidVendorId" class="hiddenValue" id="hidVendorId"/>
                </form>
            </div>
        </div>
    </div>
</div>
   

{% block javascript %}

<script>
             //Sidenav
	        function openNav() {
  	                document.getElementById("mySidepanel").style.width = "200px";
	            }
	        function closeNav() {
	            document.getElementById("mySidepanel").style.width = "0px";
	            }
                function format (d) {
                    // `d` is the original data object for the row
                    var url = "{% url 'viewmore' 0 %}";
                    var id = d.vendor_id;
                    url = url.replace(0, id);
                    //'<a href=' + url + '>Download TSDF</a>';
                    if (d.primary_contact_no){
                        primary_contact_no =d.primary_contact_no
                    }else
                    {
                        primary_contact_no=""
                    }
                    if (d.expiry_date){
                        expiry_date =d.expiry_date
                    }else
                    {
                        expiry_date=""
                    }
                    return '<table cellpadding="10" cellspacing="0" border="0" style="padding-left:20px;">'+

                    '<tr>'+
                        '<td>Primary Contact Name:</td>'+
                        '<td>'+d.primary_contact_name+'</td>'+
                    '</tr>'+
                    '<tr>'+
                        '<td>Primary contact No:</td>'+
                        '<td>'+primary_contact_no+'</td>'+
                    '</tr>'+
                    '<tr>'+
                        '<td>Insurance Expiry Date:</td>'+
                        '<td>'+ expiry_date +'</td>'+
                    '</tr>'+
                    '<tr>'+
                        '<td>'+'<a cellpadding="5" style="padding-top:10px" class="viewmore"name="View" href='+url +'>ViewMore</a>'+'</td>'+
                    '</tr>'+
                    '</table>';

                    }
</script>
 <script>
//Datatable
$(document).ready(function () {
var dataTable = $('#example').DataTable({
  "ordering": true,
  //"scrollY":  250,
  "paging": true,
 // scrollX: true,
//scrollCollapse: true,

  "bLengthChange" : false,
    buttons: [
       {      
        text: '<h4 style="font-size: 16px;font-weight:bold">&nbsp;&nbsp;<i class="fa fa-plus fa-x5"></i> &nbsp;&nbsp;Add Vendor&nbsp;&nbsp;&nbsp;</h4>',
        className: 'btnvendor',
        action: function ( e, dt, button, config) {
        window.location = 'addVendor';
        }        
      },
    ], 
    //responsive: {
    //breakpoints: [
      //{name: 'bigdesktop', width: Infinity},
      //{name: 'meddesktop', width: 1480},
      //{name: 'smalldesktop', width: 1280},
      //{name: 'medium', width: 1188},
      //{name: 'tabletl', width: 1024},
      //{name: 'btwtabllandp', width: 848},
      //{name: 'tabletp', width: 768},
      //{name: 'mobilel', width: 480},
      //{name: 'mobilep', width: 320}
    //]
  //},
    //Move search from right to left
    "dom": '<"pull-left"f><"pull-right"l>tpi' ,
    "order": [
            [1, 'asc']
        ],
    
    "columns": [
    { 'orderable': false,"width": "3%" },
    { "width": "15%" },
    { "width": "15%" },
    { "width": "15%" },
    { "width": "15%" },
    { 'orderable': false,"width": "3%" },
    { 'orderable': false,"width": "3%" }
           ],
    //Search Icon
    "oLanguage": { "sSearch": '<a class="btn searchBtn" id="searchBtn"  style="float:right;vertical-align:middle"><i class="fa fa-search"></i></a>' ,}
  });

 
  // ADD Button
  dataTable.buttons().container().appendTo($('#test'));

    $('.dataTables_filter input[type ="search"]').css(
      {'width':'450px','margin-bottom':'7px','vertical-align':'baseline'}
  ); 

  $(".dataTables_wrapper").css("width","100%");  

  // Add event listener for opening and closing details
    $('#example tbody').on('click', 'td.details-control', function () {
        var id = $(this).closest('tr').attr('id');
        var tr = $(this).closest('tr');
        var row = dataTable.row( tr );
         var pos = dataTable.row(this).index();
         var row2 = dataTable.row(pos);


        console.log("ID"+ id)
        if ( row2.child.isShown() ) {
            // This row is already open - close it
            row2.child.hide();
            tr.removeClass('shown');
        }
        else {
                $.ajax({
                    url: '{% url "table_info" %}',
                            data: {
                                'id': id,
                                },
                    dataType: 'json',
                    success: function (data) {
                    //console.log("Json object",data[0])
                    if (data.user_info)
                        {
                            row.child( format(data.user_info) ).show();
                            //row2.child( format("Jeyajothi") ).show();
                            tr.addClass('shown');
                        }
                        }
                    });
                    // Open this row


        }
    });


});
//.................logout................
$(document).on("click", '#navbarDropown1', function(e) {

    bootbox.confirm({
        title:"Logout",
        message: "Do you want to Logout?",
        buttons: {
            confirm: {
                label: 'Yes',
                className: 'btn-success'
            },
            cancel: {
                label: 'No',
                className: 'btn-danger'
            }
        },
        callback: function (result) {
        if(result)
        {

            //$('#navbarDropown1').attr('href', "account/logout")
            window.location.href="account/logout"

        }


        }

    });
});


function deleteUser(id, name) {
  //console.log(id)
    //alert (id);
    bootbox.confirm('Do you really want to delete: "' + name + '"', function(result) {
    if(result){

    // AJAX Request
    $.ajax({
    url: '{% url "delete_vendor_details" %}',
    data: { id:id },
    success: function(data)
    {
        // Removing row from HTML Table
        if (data.deleted) {
              $("#example #user-" + id).remove();
               location.reload();
            }
        else{
		    bootbox.alert('Record not deleted.');

	    }

    }
  });
  }
});
}



  //old Delete function
  //var action = confirm("Are you sure you want to delete this user?");
  //if (action != false) {
    //$.ajax({
        //url: '{% url "delete_vendor_details" %}',
        //data: {
            //'id': id,
        //},
        //dataType: 'json',
        //success: function (data) {

            //if (data.deleted) {
              //$("#example #user-" + id).remove();
            //}
        //}
    //});
  //}




</script>









</script>
{% endblock javascript %}
<!--
<script type="text/javascript">
$(document).ready(function(){
     console.log("hi");
    //console.log($('.btn btn-danger').attr("value"));
    //console.log($('.btn btn-danger').attr("title"));
    //console.log($('.btn btn-danger').val());
    //console.log($('.btn btn-danger').text);

    $('.button.btn btn-prim btn-xs').click(function(){

            console.log("hi");
            var title  = $('.btn btn-prim btn-xs').val();

            console.log("hi");
            console.log(title);
    //console.log($('.btn btn-danger').attr("name"));
    //console.log($('.btn btn-danger').attr("value"));
    //console.log($('.btn btn-danger').attr("title"));
    //console.log($('.btn btn-danger').val());
    //console.log($('.btn btn-danger').text);


            $('.btn btn-danger').val(title);
            console.log($('.btn btn-danger').val(title));

    })
})
</script>
-->
</body>

</html>